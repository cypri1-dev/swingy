@startuml
title Architecture MVC - Jeu RPG

' =======================
'   COUCHES DU SYSTÈME
' =======================

package "Model" #LightBlue {
  class Characters {
    -String type
    -String name
    -String characterClass
    -int level
    -int xp
    -int attack
    -int defense
    -int hitPoint
    -int maxHitPoint
    -List<Artefact> bag
    -Coordinates coord
    -Knowledge knowlegde
    #Characters(String type, String name, String class)
    #void setName(String name)
    #void setClass(String characterClass)
    #void setLevel(int level)
    #void setXp(int xp)
    #void setAttack(int attack)
    #void setDefense(int attack)
    +void setHitPoint(int hp)
    +void setMaxHitPoint(int hp)
    +void setHealHp(int hp)
    +String getName()
    +String getClass()
    +String getCharacterClass()
    +int getLevel()
    +int getXp()
    +int getAttack()
    +int getDefense()
    +int getHitPoint()
    +int getMaxHitPoint()
    +GameMovement getMovement()
    +List<Artefact> getArtefacts()
    +Coordinates getCoordinates()
    +Knowledge getKnowledge()
    +void addArtefact(Artefact item)
    +void removeArtefcat(Artefact item)
    +void addXP(int amount)
    +void equipArtefact(Artefact item)
    +void unequipArtefact(Artefact item)
  }

  class Hero {
    -GameMovement movement
    +Hero(String type, String name, String characterClass)
    +GameMovement getMovement()
  }

  class Enemy {
    +Enemy(String type, String name, String characterClass)
  }

  class Knowledge {
    -static Knowledge instance
    -Map<String, Integer> knowledge
    -Knowledge()
    +static Knowledge getInsatance()
    +void addKnowledge(Characters enemy)
    +Map<String, Integer> getMap()
  }

  class Artefact {
    -String type
    -String name
    -String rarity
    -int bonus
    -bool isEquipped
    -Coordinates coord
    #Artefact(String type, String name, String rarity, int bonus)
    +void setIsEquipped(bool equipped)
    +String getType()
    +String getName()
    +int getBonus()
    +bool getIsEquipped()
    +Coordinates getCoordinates()
    +String getRarity()
  }

  class Weapon {
    +Weapon(String type, String name, String rarity, int bonus)
  }

  class Armor {
    +Armor(String type, String name, String rarity, int bonus)
  }

  class Helm {
    +Helm(String type, String name, String rarity, int bonus)
  }

  class Consommable {
    +Consommable(String type, String name, String rarity, int bonus)
  }

  class Coordinates {
    -int x
    -int y
    -int prevX
    -int prevY
    ~Coordinates(int x, int y)
    +void setX()
    +void setY()
    +void setPrevX()
    +void setPrevY()
    +int getX()
    +int getY()
    +int getPrevX()
    +int getPrevY()
    +void setXBack(int x)
    +void setYBack(int y)
  }

  class Maps {
    -int size
    -int[][] map
    -List<Characters*> enemiesList
    -Characters mainHero
    -bool levelCompleted
    -List<Artefact> consommableList
    #Maps(int size, int[][] map)
    +setSize(int size)
    +List<Artefact> getListConsommable()
    +List<Characters> getListEnemies()
    +bool getLevelCompleted()
    -initMap()
    -void generateRandomConsommable(List<String> occupiedCoords)
    -List<String> generateRandomEnemies()
    -Artefact createRandomLoot(String rarity)
    -Map<String, Integer> getWeaponMapByRarity(String rarity)
    -Map<String, Integer> getArmorMapByRarity(String rarity)
    -Map<String, Integer> getHelmMapByRarity(String rarity)
  }

  class CharactersFactory <<Singleton>> {
    -static CharactersFactory instance
    -CharactersFactory()
    +static CharactersFactory getInstance()
    +Characters* newCharacters(String type, String name, String characterClass)
  }

  class ArtefactFactory <<Singleton>> {
    -static ArtefactFactory instance
    -ArtefactFactory()
    +static ArtefactFactory getInstance()
    +Artefact* newArtefact(String type, String name, int bonus)
  }

  class MapFactory <<Singleton>> {
    -static MapFactory instance
    -MapFactory()
    +static MapFactory getInstance()
    +Maps* newMap(int size, int[][] map)
  }
}

package "Controller" #LightGreen {
  class Game {
    -List<Characters> availableHeros
    -Characters selectedHero
    -Menu Menu
    -Maps actualMap
    -List<String> herosName
    +Game()
    +Menu getMenu()
    +Maps getMap()
    +List<String> getHeroesNameList()
    +Characters getMainHero()
    +List<Characters> getListAvaible()
    +void setSelectedHero(Characters hero)
    +void setActualMap(Maps map)
    +void placeHero(Characters hero)
    +void runArenaLoop(Menu menu)
    +void moveHero(char arrow, Menu menu)
    +bool heroExists(String name)
    +bool registerHeroName(String name)
    +void healHero(int amount)
    +launchGame()
  }

  class Menu {
    -Game ref
    -static DisplayController display
    ~Menu(Game game)
    +void launchGame()
    +void d_vOption()
    +void inventoryMenu()
    -void creationOption()
    -void heroesManagementOption()
    -void arenaOption()
    -void exitOption()
    -void createHero()
    -Characters selectHero(Game game)
    -void viewMyHeros()
    -void removeHero()
    -void endArena()
    -void equipOption()
    -void unequipOption()
    -void dropOption()
    -void potionOption()
  }

  class GameMovement {
    -void checkFight(Characters hero, Maps map, Menu menu)
    -void checkConsommable(Characters hero, Maps map)
    -void checkEndLevel(Characters hero, Maps map)
    +void moveNorth(Hero hero)
    +void moveEast(Hero hero)
    +void moveSouth(Hero hero)
    +void moveWest(Hero hero)
  }

  class FightLogic {
    -static DisplayController display
    +static void fight(Characters enemy, Characters hero, Menu menu)
  }

  class Import {
    -static DisplayController display
    +static void fileParser(Game ref)
    +static boolean fileChecker()
    -static Characters importCharacter(String line)
    -static boolean importBag(Characters hero, String line)
    -static boolean importKnowledge(Characters hero, String line)
    -static void addLoadHero(Game ref, Characters importHero)
    -static void removeLoadHero(Game ref, Characters importHero)
  }

  class Export {
    +static void exportData(List<Characters> avaibleHeros)
  }

  class GuiCreationController {
    +static String createHero(Game rpg, String inputName, String selectedClass)
  }

  class GuiInventoryController {
    +static String buildFormatedString(Game rpg)
    +static String buildFormattedItem(Artefact items)
    +static void inventoryManager(JCheckBox checkBox, Map<String, List<JCheckBox>> checkBoxesByType, Characters hero, ItemEvent e)
    +static void checkPotion(Game rpg, JPanel baseInventory)
  }

  class GuiHeroManagementController {
    +static String displaySelectHero(String selectedHeroName, Game rpg)
    +static String deleteHero(String selectedHeroName, Game rpg)
  }

  class GuiInputController {
    +GuiInputController(JComponent panel, GameMovement movement, Characters hero, Maps map, Menu menu, JPanel grid, Game rpg, Map<String, ImageIcon> listToken, Icon icon, JPanel baseInventory)
    -void bind(JComponent comp, String key, Runnable action)
    -boolean canMove(int x, int y)
    -void update(JComponent panel)
  }

  class GuiLaunchGamecontroller {
    +static String selectHeroGame(String selectedHeroName, Game rpg, Icon tokenIcon)
  }
}

package "View" #LightYellow {

   package "components" <<UI Components>> {
    class BackgroundPanel {
      -final Image backgroundImage
      +BackgroundPanel(Image img)
      #void paintComponent(Graphics g)
    }

    class FadingLabel {
      -float alpha
      +FadingLabel(String text)
      +void setAlpha(float alpha)
      +float getAlpha()
      #void paintComponent(Graphics g)
    }

    class FadingToken {
      -float alpha
      +FadingToken(ImageIcon token)
      +void setAlpha(float alpha)
      +float getAlpha()
      #void paintComponent(Graphics g)
    }

    class RoundedImageButton {
      -int radius
      +RoundedImageButton(String text, Image Icon)
      #void paintComponent(Graphics g)
    }
  }

  class DisplayController {
    -static DisplayController instance
    -DisplayController()
    +static DisplayController getInstance()
    +void sleepTime(int time)
    +void printNormal(String txt)
    +void printSlow(String asciiArt)
    +void clearTerminal()
    +void printMyHeroes(Game game)
    +void displayMap(Game game)
    +void displaySelectedHero(Characters hero)
    +void displayCurrentEnemy(Characters enemy, int knowledge)
    +String getUserInput()
    +void closeScanner()
  }

  abstract class GuiCustomPage {
    -static Dimension
    -static boolean showingPagePotion
    -static boolean showingFightPage
    +static JPanel wrapperCheckboxGenerator(JCheckBox elem, int top, int left, int bottom, int right)
    +static JPanel wrapperComboBox(JComboBox<String> elem)
    +static JPanel wrapperJTextFieldGenerator(JTextField elem)
    +static JPanel wrapperButtonGenerator(RoundedImageButton elem, int top, int left, int bottom, int right)
    +static JPanel wrapperLabelGenerator(JLabel elem, int top, int left, int bottom, int right, boolean setBorder, boolean setSize)
    +static JPanel wrapperLabelGeneratorInventory(JLabel elem, int top, int left, int bottom, int right, boolean setSize)
    +static void configureJPanelFight(JPanel panel)
    +static void configureTabPanel(JTabbedPane tabPanel)
    +static void configureBottomPanel(JPanel elem, RoundedImageButton btn)
    +static void configButtons(RoundedImageButton btn)
    +static void configureComboBox(JComboBox<String> elem)
    +static void configureHiddenLabel(JLabel elem)
    +static void configureJScrollPane(JScrollPane elem)
    +static void configureJTextField(JTextField elem)
    +static BufferedImage selectRandomBackground()
    +static Icon rescaleToken(Icon token, int size)
    +static void setCustomFont(JComponent elem, int type, int size)
    +static JPanel createBaseStructure()
    +static boolean getShowingPagePotion()
    +static void setShowingPagePotion(boolean set)
    +static boolean getShowingPageFight()
    +static void setShowingPageFight(boolean set)
  }

  class GuiMainWindow {
    -CardLayout cardLayout
    -JPanel cardPanel
    -Game rpg
    -static Map<String, ImageIcon> listToken
    -static Map<Integer, BuffuredImage> listBackground
    -void initImages()
    +GuiMainWindow(Game rpg)
    +CardLayout getCardLayout()
    +JPanel getCardPanel()
    +static Map<String, ImageIcon> getListTokens()
    +Game getGame()
    +static Map<Integer, BufferedImage> getBackgrounds()
  }

  class GuiCreationPage {
    -static void configureConfirmButton(RoundedImageButton elem, JTextField inputName, JComboBox<String> choiceComboBox, JLabel hiddenNameLabel, JPanel hiddenNameLabelWrapper, JPanel base, Game rpg)
    +static JPanel createCreationPage(String title, CardLayout cardLayout, JPanel cardPanel, ImageIcon icon, Game rpg)
  }

  class GuiEndLevelPage {
    +static void showLevelCompletePage(JComponent panel, Characters hero, Game rpg)
  }

  class GuiFightPage {
    +static void showFightPage(JComponent panel, Characters enemy, Game rpg)
  }

  class GuiHeroManagerPage {
    -static JComboBox<String> choiceComboBox
    -static void configureConfirmButton(RoundedImageButton elem, String selectedName, JComboBox<String> choiceComboBox, JLabel hiddenNameLabel, JPanel hiddenNameLabelWrapper, JPanel base, Game rpg)
    -static void configureDeleteButton(RoundedImageButton btnDelete, Game rpg, JLabel hiddenNameLabel, JPanel hiddenNameLabelWrapper, JPanel base)
    +static void updateHeroComboBox(Game rpg)
    +static JPanel createViewPage(String title, CardLayout cardLayout, JPanel cardPanel, ImageIcon icon, Game rpg)
    +static JComboBox<String> getComboBox()
  }

  class GuiMainMenuPage {
    -static JPanel wrapperButtonGenerator(RoundedImageButton btnCreate, RoundedImageButton btnSelect, RoundedImageButton btnPlay, RoundedImageButton btnExit)
    -static JPanel createPageMainMenu(ImageIcon icon, JPanel cardPanel, CardLayout cardLayout, Game rpg)
  }

  class GuiMapTab {
    +static void updateMap(Game rpg, Map<String, ImageIcon> listToken, JPanel grid)
    +static void loadToken(Map<String, ImageIcon> listToken, JPanel cell, String nameEnemy)
    +static void drawMap(Game rpg, Map<String, ImageIcon> listToken, JPanel grid)
  }

  class GuiPlayPage {
    -static JComboBox<String> choiceComboBox
    -static final JLabel[] selected
    -static JPanel createTokenSelector(Map<String, ImageIcon> listToken)
    +static void updateHeroComboBox(Game rpg)
    +static JPanel createPlayPage(String title, CardLayout cardLayout, JPanel cardPanel, ImageIcon icon, Map<String, ImageIcon> listToken, Game rpg)
    +static JLabel[] getSelected()
  }

  class GuiPotionPage {
    +static void showPotionPage(JComponent panel, Artefact potion, Map<String, ImageIcon> listToken, Icon icon, JPanel grid, JPanel baseInventory, Game rpg)
  }

  class GuiWelcomePage {
    -static void configureButton(RoundedImageButton btn, CardLayout cardLayout, JPanel cardPanel)
    -static void configurePanelTokens(JPanel elem)
    +static JPanel createPageWelcome(String title, CardLayout cardLayout, JPanel cardPanel, ImageIcon icon, Map<String, ImageIcon> listToken)
  }
}

' =======================
'   RELATIONS
' =======================

' --- Héritages ---
Characters <|-- Hero
Characters <|-- Enemy
Artefact <|-- Armor
Artefact <|-- Weapon
Artefact <|-- Helm
Artefact <|-- Consommable

GuiCustomPage <|-- GuiWelcomePage
GuiCustomPage <|-- GuiPotionPage
GuiCustomPage <|-- GuiPlayPage
GuiCustomPage <|-- GuiMapTab
GuiCustomPage <|-- GuiMainMenuPage
GuiCustomPage <|-- GuiHeroManagerPage
GuiCustomPage <|-- GuiFightPage
GuiCustomPage <|-- GuiEndLevelPage
GuiCustomPage <|-- GuiCreationPage
GuiCustomPage <|-- GuiMainWindow

' --- Associations internes du modèle ---
Characters *-- Artefact
Characters *-- Coordinates
Characters *-- Knowledge
Maps *-- Characters
Maps *-- Artefact

Hero --> GameMovement
Knowledge --> Characters

' --- Fabriques (Singletons) ---
CharactersFactory ..> Hero
CharactersFactory ..> Enemy
ArtefactFactory ..> Artefact
MapFactory ..> Maps

' --- Relations principales du contrôleur ---
Game --> Menu
Game --> Maps
Game --> Characters
Menu --> Game
GameMovement --> Maps
FightLogic --> DisplayController

' --- Vue vers contrôleur et modèle ---
DisplayController --> Game
DisplayController --> Menu
DisplayController ..> Characters
DisplayController ..> Maps

' --- Import / Export simplifiés ---
Import --> Game : "charge sauvegarde"
Import --> DisplayController
Import ..> Model : "utilise le modèle"

Export --> DisplayController
Export ..> Model : "sauvegarde le modèle"

@enduml
